---
title: "コンテナ仮想化 主な知識分野"
date: 2024-07-18T19:17:57+09:00
---

### システムとアプリケーションのコンテナの概念

#### システムコンテナ
- **概要**: システムコンテナは、フル機能のオペレーティングシステム環境を提供し、仮想マシンに似ていますが、共有カーネルの上で実行されます。
- **使用例**: LXC（Linux Containers）。
- **特徴**:
  - フルOSイメージを使用。
  - 高い隔離レベル。
  - 仮想マシンと同様のシステム管理ツールを使用可能。

#### アプリケーションコンテナ
- **概要**: アプリケーションコンテナは、特定のアプリケーションとその依存関係をパッケージ化し、ホストOS上で動作します。
- **使用例**: Docker。
- **特徴**:
  - 軽量。
  - 高速な起動時間。
  - より細かいリソース管理が可能。

### カーネルネームスペースを理解し分析する

#### 概要
カーネルネームスペースは、プロセスに異なるシステムリソースのビューを提供し、プロセスを分離します。

#### 種類
1. **PIDネームスペース**: プロセスIDの分離。
2. **UTSネームスペース**: ホスト名とNISドメイン名の分離。
3. **Mountネームスペース**: マウントポイントの分離。
4. **IPCネームスペース**: IPCリソースの分離。
5. **Networkネームスペース**: ネットワークスタックの分離。
6. **Userネームスペース**: ユーザーとグループIDの分離。
7. **Cgroupネームスペース**: コントロールグループの分離。

### コントロールグループを理解し分析する

#### 概要
コントロールグループ（cgroups）は、プロセスのリソース使用を管理・制限するための機能です。

#### 主な機能
- **リソース制限**: CPU、メモリ、I/O、ネットワーク帯域などを制限。
- **リソース隔離**: プロセス間でのリソースの競合を防止。
- **リソース計測**: プロセスのリソース使用を監視。
- **リソース優先度**: プロセスの優先度を設定。

### ケイパビリティを理解し分析する

#### 概要
ケイパビリティは、ルート権限を細分化してプロセスに特定の管理権限を付与する仕組みです。

#### 主なケイパビリティ
- **CAP_CHOWN**: ファイルの所有者を変更。
- **CAP_DAC_OVERRIDE**: アクセス制御リストを無視してファイルにアクセス。
- **CAP_NET_BIND_SERVICE**: 特権ポート（1024未満）にバインド。

### コンテナ仮想化におけるseccomp, SELinux, AppArmorの役割

#### seccomp
- **概要**: seccomp（Secure Computing Mode）は、システムコールをフィルタリングしてプロセスの攻撃面を削減するLinuxカーネルの機能。
- **使用例**: Dockerでのシステムコール制限。

#### SELinux
- **概要**: SELinux（Security-Enhanced Linux）は、Linuxカーネルの強制アクセス制御（MAC）システム。
- **使用例**: コンテナ内でのアクセス制御ポリシーの強化。

#### AppArmor
- **概要**: AppArmorは、プロセスごとに適用されるセキュリティポリシーを定義するMACシステム。
- **使用例**: Ubuntu上のコンテナセキュリティ。

### LXCとDockerがnamespace, cgroups, ケイパビリティ、seccomp, MACにどのように影響を及ぼすか

#### LXC（Linux Containers）
- **namespace**: 全てのネームスペースを使用してコンテナを分離。
- **cgroups**: リソース管理と制限に使用。
- **ケイパビリティ**: 特定の権限を付与。
- **seccomp**: 制限的なシステムコールフィルタリングを使用。
- **MAC**: AppArmorやSELinuxでのポリシー管理。

#### Docker
- **namespace**: 主要なネームスペースを使用してコンテナを分離（PID、UTS、Mount、Network、User）。
- **cgroups**: デフォルトでリソース管理を実施。
- **ケイパビリティ**: 必要な最小限のケイパビリティを使用。
- **seccomp**: デフォルトでseccompプロファイルを適用。
- **MAC**: SELinuxやAppArmorをサポート。

### runcの概念

#### 概要
`runc`は、Open Container Initiative（OCI）仕様に準拠した軽量のコンテナランタイムです。Dockerや他のコンテナエンジンの下位ランタイムとして使用されます。

#### 主な機能
- OCIコンテナ仕様の実装。
- コンテナの作成、実行、停止。

### CRI-Oとcontainerdの理解

#### CRI-O
- **概要**: KubernetesのContainer Runtime Interface（CRI）を実装するコンテナランタイム。
- **目的**: Dockerの代替としてKubernetes専用に設計。
- **特徴**: シンプルで軽量。

#### containerd
- **概要**: Dockerのコンテナランタイムとして開発されたが、現在は独立したランタイム。
- **目的**: 高性能で信頼性の高いコンテナ管理。
- **特徴**: OCIコンテナ仕様に準拠。

### OCIランタイムとimage-spec(image specification)の知識

#### OCIランタイム
- **概要**: Open Container Initiativeが定義する標準的なコンテナランタイム仕様。
- **目的**: 互換性と相互運用性を確保。

#### image-spec
- **概要**: OCIが定義するコンテナイメージの標準仕様。
- **目的**: 互換性と一貫性を確保。

### Kubernetes Container Runtime Interface (CRI)の知識

#### 概要
CRIは、Kubernetesが様々なコンテナランタイムと通信するためのAPI仕様です。

#### 目的
- コンテナランタイムの抽象化。
- ランタイムの交換可能性。

### podman, buildah, skopeoの知識

#### podman
- **概要**: ルートレスコンテナをサポートするDocker互換のコンテナ管理ツール。
- **特徴**: デーモンレスアーキテクチャ。

#### buildah
- **概要**: OCIコンテナイメージの構築ツール。
- **特徴**: Dockerfile不要でイメージを構築。

#### skopeo
- **概要**: コンテナイメージの取得、検査、転送ツール。
- **特徴**: リポジトリ間でのイメージ転送。

### Linuxとそれ以外のコンテナ仮想化アプローチの知識

#### rkt
- **概要**: CoreOSによって開発されたコンテナランタイム。セキュリティに重点。
- **特徴**: ポッドベースのモデル。

#### OpenVZ
- **概要**: 完全な仮想化を提供するLinuxカーネルのコンテナベースの仮想化技術。
- **特徴**: 高いパフォーマンスと隔離。

#### systemd-nspawn
- **概要**: systemdで提供されるコンテナ管理ツール。
- **特徴**: 軽量なコンテナ管理。

#### BSD Jails
- **概要**: FreeBSDのコンテナ仮想化技術。
- **特徴**: 高い隔離レベルとセキュリティ。

これらの知識は、コンテナ仮想化環境の管理と運用において重要な役割を果たします。
